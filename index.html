<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Three.js Black Hole</title>
    <style>
      body {
        margin: 0;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.135.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.135.0/examples/js/controls/OrbitControls.js"></script>
    <script>
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        10000
      );
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.physicallyCorrectLights = true;
      document.body.appendChild(renderer.domElement);

      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      // Aggiungi una luce ambientale più forte
      const ambientLight = new THREE.AmbientLight(0xffff99, 50);
      scene.add(ambientLight);

      // Aggiungi una luce direzionale
      // const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
      // directionalLight.position.set(500, 500, 500);
      // scene.add(directionalLight);

      const loader = new THREE.GLTFLoader();
      let model;

      loader.load(
        "models/black_hole.glb",
        function (gltf) {
          // Itera sui nodi del modello per trovare la sfera centrale
          gltf.scene.traverse(function (node) {
            console.log(node.name);
            if (node.isMesh && node.name !== "black_hole_black_hole_center_0") {
              node.material.emissive = new THREE.Color(0xffff99); // Imposta l'emissività
              node.material.emissiveIntensity = 0.3; // Aumenta l'intensità dell'emissività
            }
          });
          model = gltf.scene;
          model.position.set(0, 0, 0);
          model.rotation.z -= 3.14 / 8;

          const box = new THREE.Box3().setFromObject(gltf.scene);
          const boxSize = box.getSize(new THREE.Vector3()).length();
          const boxCenter = box.getCenter(new THREE.Vector3());

          // Aggiungi una PointLight giallastra
          const pointLight = new THREE.PointLight(0xffa542, 500000, boxSize); // Colore giallo chiaro, intensità 10, distanza 100
          pointLight.position.set(0, 0, 0); // Posiziona la luce al centro della scena
          scene.add(pointLight);

          // Aggiungi il modello alla scena
          scene.add(model);

          // Posiziona la telecamera ad una distanza che permetta di vedere tutto l'oggetto
          camera.position.x = 0;
          camera.position.y = 50;
          camera.position.z = 1800;
          camera.lookAt(boxCenter);

          controls.target.copy(boxCenter);
        },
        undefined
      );

      function animate() {
        requestAnimationFrame(animate);
        if (model) {
          model.rotation.y += 0.002; // Ruota intorno all'asse Y
        }
        controls.update();
        renderer.render(scene, camera);
      }
      animate();
    </script>
  </body>
</html>
